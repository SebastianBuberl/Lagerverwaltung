<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lagerplatz LED Ausgabe</title>
    <style>
        .fach-container {
            display: flex;  
            justify-content: flex-start;
            gap: 5px;
            margin: 10px 0;
        }

        .fach {
            font-size: 20px;
            display: flex;  
            width: 40px;
            height: 40px;
            border-radius: 50%;
            gap: 12px;
            border: 1.5px solid #000;
            margin-left: 20px;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 
            -1px -1px 0px #000,
             0px -1px 0px #000,
             1px -1px 0px #000,
            -1px  0px 0px #000,
             1px  0px 0px #000,
            -1px  1px 0px #000,
             0px  1px 0px #000,
             1px  1px 0px #000;
        }

        .output-container {
        padding-top: 20px;
        display: flex; /* Stellt sicher, dass die Ausgabe in einer eigenen Zeile ist */
        }

        .fach-container {
            display: flex;  
            gap: 5px;
            margin-bottom: 20px; /* Abstand nach der Grafik */
        }

        .personen-liste {
            list-style-type: none;
            padding-left: 20px;
            margin-top: 8px;
        }

        .personen-liste li {
            margin: 5px 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Suche nach LEDs auf einem Lagerplatz</h1>

    
    <!-- Input für das Hochladen der JSON-Datei -->
    <input type="file" id="fileInput" accept=".json" /> <br><br>
    
    <label for="lagerplatz">Lagerplatz Nummer:</label>

    <input type="number" id="lagerplatz" placeholder="Lagerplatznummer eingeben" min="1" max="100" value="1" />
    
    <button id="sucheButton">Suchen</button>


    <div id="output" class="output-container"></div>

    <script>
        let PersonalDaten = []; // Initialisierung für PersonalDaten

        // Event-Listener für die Datei-Auswahl
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file && file.name.endsWith('.json')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // JSON-Daten laden
                        const data = JSON.parse(e.target.result);
                        PersonalDaten = data; // Die hochgeladenen Daten setzen
                        alert("JSON-Datei erfolgreich geladen!");
                    } catch (error) {
                        alert("Fehler beim Verarbeiten der JSON-Datei.");
                    }
                };
                reader.readAsText(file);
            } else {
                alert("Bitte eine gültige JSON-Datei hochladen.");
            }
        });

        const farben = [
            {"name": "Rot", "rgb": "rgb(255, 0, 0)"},
            {"name": "Blau", "rgb": "rgb(0, 0, 255)"},
            {"name": "Grün", "rgb": "rgb(0, 255, 0)"},
            {"name": "Gelb", "rgb": "rgb(255, 255, 0)"},
            {"name": "Orange", "rgb": "rgb(255, 165, 0)"},
            {"name": "Lila", "rgb": "rgb(128, 0, 128)"},
            {"name": "Türkis", "rgb": "rgb(64, 224, 208)"},
            {"name": "Pink", "rgb": "rgb(255, 105, 180)"},
            {"name": "Braun", "rgb": "rgb(165, 42, 42)"},
            {"name": "Grau", "rgb": "rgb(128, 128, 128)"},
            {"name": "Hellgrün", "rgb": "rgb(144, 238, 144)"},
            {"name": "Dunkelblau", "rgb": "rgb(0, 0, 139)"},
            {"name": "Violett", "rgb": "rgb(238, 130, 238)"},
            {"name": "Hellblau", "rgb": "rgb(173, 216, 230)"},
            {"name": "Beige", "rgb": "rgb(245, 245, 220)"},
            {"name": "Dunkelrot", "rgb": "rgb(139, 0, 0)"},
            {"name": "Hellbraun", "rgb": "rgb(205, 133, 63)"},
            {"name": "Hellgelb", "rgb": "rgb(255, 255, 102)"},
            {"name": "Magenta", "rgb": "rgb(255, 0, 255)"},
            {"name": "Dunkelgrün", "rgb": "rgb(0, 100, 0)"},
            {"name": "Cyan", "rgb": "rgb(0, 255, 255)"},
            {"name": "Zinnober", "rgb": "rgb(227, 66, 52)"},
            {"name": "Mintgrün", "rgb": "rgb(189, 252, 201)"},
            {"name": "Blaugrün", "rgb": "rgb(0, 128, 128)"},
            {"name": "Pfirsich", "rgb": "rgb(255, 218, 185)"}
        ];

        // Füge den Personen Farben hinzu
        function addColorsToData() {
            PersonalDaten.forEach((person, index) => {
                person.farbe = farben[index] ? farben[index].rgb : "rgb(0,0,0)";  // RGB-Wert
                person.farbeName = farben[index] ? farben[index].name : "Unbekannt";  // Farbname
            });
        }

        // Funktion, die die Suche durchführt
        function sucheLagerplatz() {
            const lagerplatzAuswahl = parseInt(document.getElementById("lagerplatz").value);

            if (isNaN(lagerplatzAuswahl) || lagerplatzAuswahl <= 0) {
                alert("Bitte einen gültigen Lagerplatz eingeben.");
                return;
            }

            // Finde alle Personen, die den angegebenen Lagerplatz besitzen
            const lagerplatzPersonen = PersonalDaten.filter(personalLagerplatz => personalLagerplatz.lagerplätze.includes(lagerplatzAuswahl));

            // Anzahl der Fächer pro Lagerplatz (insgesamt)
            const faecherProLagerplatz = 6;

            // Berechne, wie viele Fächer jede Person erhält
            const anzahlPersonen = lagerplatzPersonen.length;

            // Berechnung um die Lagerfächer gleichmäßig aufzuteilen
            let faecherProPerson = Math.floor(faecherProLagerplatz / anzahlPersonen);

            // Erstelle das Array für die HTML-Ausgabe
            let lagerplatzArray = [];

            // Füge die Personen mit ihren Eigenschaften entsprechend der Anzahl der Lagerplätze hinzu
            lagerplatzPersonen.forEach(person => {
                for (let i = 0; i < faecherProPerson; i++) {
                    lagerplatzArray.push({
                        person: person.person,     // Personennummer
                        farbe: person.farbe,       // Farbe der Person
                        rgb: person.farbe,         // RGB-Wert der Person
                    });
                }
            });

            // Falls das Array weniger als 6 Elemente hat, wiederhole den Vorgang, bis es 6 Elemente enthält
            while (lagerplatzArray.length < faecherProLagerplatz) {
                lagerplatzPersonen.forEach(person => {
                    if (lagerplatzArray.length < faecherProLagerplatz) {
                        lagerplatzArray.push({
                            person: person.person,
                            farbe: person.farbe,
                            rgb: person.farbe,
                        });
                    }
                });
            }

            // Sortiere das Array nach der Personennummer (aufsteigend)
            lagerplatzArray.sort((a, b) => a.person - b.person);

            // Füge die Ausgabe in das HTML ein
            const outputDiv = document.getElementById("output");
            if (anzahlPersonen === 0) {
                outputDiv.innerHTML = `<p>Keine Personen gefunden, die Lagerplatz ${lagerplatzAuswahl} besitzen.</p>`;
            } else {
                outputDiv.innerHTML = `<p>Es gibt ${anzahlPersonen} Person(en), die Lagerplatz ${lagerplatzAuswahl} teilen.</p>`;

                // Erstelle die LEDS nebeneinander
                outputDiv.innerHTML += `<div class="fach-container">`;

                // Erstelle die LEDs für den Lagerplatz und färbe sie nach den Personen
                lagerplatzArray.forEach(personen => {
                    outputDiv.innerHTML += `<div class="fach" style="background-color: ${personen.rgb};">${personen.person}</div>`;
                });

                outputDiv.innerHTML += `</div>`;

                // Erstelle die Personenliste
                let personList = document.createElement("ul");
                personList.classList.add("personen-liste");

                // Sortiere die Lagerplatz-Personen nach der Personennummer
                lagerplatzPersonen.sort((a, b) => a.person - b.person);

                lagerplatzPersonen.forEach(person => {
                    let listItem = document.createElement("li");           
                    listItem.innerHTML = `Person ${person.person} | Farbe: ${person.farbeName} | LEDs: ${faecherProPerson}`;
                    personList.appendChild(listItem);
                });

                outputDiv.appendChild(personList);
            }
        }

        // Event Listener für den Button
        document.getElementById("sucheButton").addEventListener("click", function() {
            if (PersonalDaten.length > 0) {
                addColorsToData();
                sucheLagerplatz();
            } else {
                alert("Bitte laden Sie eine gültige JSON-Datei hoch.");
            }
        });
    </script>
</body>
</html>
